{%extends 'layout/base.html'%}

{%block title%}Đăng ký tài khoản{%endblock%}

{%block content%}
<h2 class="text-info text-center mt-3">
    Trang đăng ký
</h2>

<div class="border border-secondary border-1 m-3" style="border-radius: 20px">
    <div class="p-5">
        {%if err_msg%}
        <div class="alert alert-danger mt-3">
            {{err_msg}}
        </div>
        {%endif%}
        <form class="was-validated" method="post" enctype="multipart/form-data" id="registerForm">
            <div class="collapse show multi-collapse" id="step1">
                <h4 class="mb-3 text-secondary">Thông tin đăng nhập</h4>
                <div class="mb-3">
                    <label for="name" class="form-label">Nhập tên người dùng</label>
                    <input type="text" class="form-control" id="name" placeholder="Nhập tên người dùng"
                           name="name" required value="{{ data.get('name', '') }}"
                           oninput="this.value = this.value.replace(/^\s+/g, '')"
                           onblur="this.value = this.value.trim()">
                    <div class="invalid-feedback">Vui lòng nhập tên người dùng</div>
                </div>
                <div class="mb-3">
                    <label for="username" class="form-label">Nhập tài khoản</label>
                    <input type="text" class="form-control" id="username" placeholder="Nhập tài khoản"
                           name="username" required value="{{ data.get('username', '') }}"
                           oninput="this.value = this.value.replace(/[^a-zA-Z0-9@._-]/g, '')">
                    <div class="invalid-feedback">Vui lòng nhập tài khoản (chữ, số, @ . _ -)</div>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Nhập mật khẩu</label>
                    <input type="password" class="form-control" id="password" placeholder="Nhập mật khẩu"
                           name="password" required value="{{ data.get('password', '') }}"
                           oninput="this.value = this.value.replace(/\s/g, '')">
                    <div class="invalid-feedback">Vui lòng nhập mật khẩu</div>
                </div>
                <div class="mb-3">
                    <label for="re_enter_password" class="form-label">Nhập lại mật khẩu</label>
                    <input type="password" class="form-control" id="re_enter_password"
                           placeholder="Nhập lại mật khẩu" name="re_enter_password" required
                           value="{{ data.get('re_enter_password', '') }}"
                           oninput="this.value = this.value.replace(/\s/g, '')">
                    <div class="invalid-feedback">Vui lòng nhập lại mật khẩu</div>
                </div>
                <div class="mt-4 text-end">
                    <button class="btn btn-primary" type="button" onclick="validateAndNext()">
                        Tiếp theo <i class="bi bi-arrow-right"></i>
                    </button>
                </div>
            </div>
            <div class="collapse multi-collapse" id="step2">
                <h4 class="mb-3 text-secondary">Thông tin cá nhân</h4>
                <div class="mb-3">
                    <label for="image" class="form-label">Chọn ảnh avatar</label>
                    <input type="file" class="form-control" id="image" name="image" accept=".png"
                           required>
                    <div class="invalid-feedback">Vui lòng chọn ảnh avatar</div>
                </div>
                <div class="mb-3">
                    <label for="phone_number" class="form-label">Nhập số điện thoại</label>
                    <input type="tel" class="form-control" id="phone_number" placeholder="Nhập số điện thoại"
                           name="phone_number" required minlength="10" maxlength="10" pattern="[0-9]{10}"
                           value="{{ data.get('phone_number', '') }}"
                           oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                    <div class="invalid-feedback">Vui lòng nhập đủ 10 số</div>
                </div>
                <div class="mb-3">
                    <label for="dob" class="form-label">Nhập ngày sinh</label>
                    <input type="date" class="form-control" id="dob" name="dob" required
                           value="{{ data.get('dob', '') }}">
                    <div class="invalid-feedback">Vui lòng nhập ngày sinh</div>
                </div>
                <div class="mb-3">
                    <label for="email" class="form-label">Nhập email người dùng</label>
                    <input type="email" class="form-control" id="email" placeholder="Nhập email người dùng"
                           name="email" required value="{{ data.get('email', '') }}"
                           oninput="this.value = this.value.replace(/^\s+/g, '')">
                    <div class="invalid-feedback">Vui lòng nhập email hợp lệ</div>
                </div>
                <div class="mt-4 d-flex justify-content-between">
                    <button class="btn btn-secondary" type="button"
                            data-bs-toggle="collapse"
                            data-bs-target=".multi-collapse"
                            aria-expanded="false"
                            aria-controls="step1 step2">
                        <i class="bi bi-arrow-left"></i> Quay lại
                    </button>
                    <button class="btn btn-primary" type="submit">
                        Đăng ký tài khoản
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>
<script>
    function validateAndNext() {
        const step1Container = document.getElementById('step1');
        const inputs = step1Container.querySelectorAll('input');
        let isValid = true;
        for (const input of inputs) {
            if (!input.checkValidity()) {
                isValid = false;
                input.reportValidity();
                break;
            }
        }
        if (isValid) {
            const collapseStep1 = bootstrap.Collapse.getOrCreateInstance('#step1');
            const collapseStep2 = bootstrap.Collapse.getOrCreateInstance('#step2');
            collapseStep1.hide();
            collapseStep2.show();
        }
    }
</script>
{%endblock%}